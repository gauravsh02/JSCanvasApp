<!DOCTYPE html>
<!--
Author : Gaurav Shankar
Email : gauravshankar.bk@gmail.com
github : https://github.com/gauravsh02
-->
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Simple Canvas App</title>
  <style>
    canvas {
      border: 1px solid #555;
    }
    body {
      font-family: "Arial", Helvetica, sans-serif;
      text-align: center;
    }
    button {
      float: right;
      margin:10px 20px 0px 10px;
      padding: 5px 8px 5px 8px;
      font-size: 1.5em;
      border-style: solid;
      background-color: #ee3d1d;
      border-radius: 8px;
    }
  </style>
</head>
<body>
  <!-- <h2>Simple Canvas App</h2> -->
  <canvas id='canvas1'></canvas>
  <button id='clear' onclick='clear();'>Clear</button>
</body>
<script>
function Triangle (ix, iy, fx, fy, rgb){
  var ydiff = Math.abs(fx-iy);
  var xc = Math.floor(Math.abs(ydiff/Math.tan(30))/2);
  this.x1 = ix || 1;
  this.y1 = iy || 1;
  this.x2 = fx+xc || 2;
  this.y2 = fy || 2;
  this.x3 = fx-xc || 0;
  this.y3 = fy || 1;
  this.rgb = rgb || 'rgb(200, 200, 200)';
};
//function to draw triangle
Triangle.prototype.drawTriangles = function(ctx){
  ctx.beginPath();
  ctx.moveTo(this.x1, this.y1);
  ctx.lineTo(this.x2, this.y2);
  ctx.lineTo(this.x3, this.y3);
  ctx.lineTo(this.x1, this.y1);
  ctx.lineWidth=2;
  ctx.stroke();
  ctx.fillStyle = this.rgb;
  ctx.fill();
};
/*
function to check position of click if it lies inside triangle
it compares the area of the triangle with total area with
formed by taking (x, y) as third point and other two point from triangle
*/
Triangle.prototype.checkPos = function(x, y){
  let ar1 = getArea(this.x1, this.y1, this.x2, this.y2, x, y);
  let ar2 = getArea(this.x1, this.y1, x, y, this.x3,this. y3);
  let ar3 = getArea(x, y, this.x2, this.y2, this.x3, this.y3);
  let area = getArea(this.x1, this.y1, this.x2, this.y2, this.x3, this.y3);
  return area === ar1+ar2+ar3;
};
//retur area of triangle
function getArea(x1, y1, x2, y2, x3, y3){
  return Math.abs((x1*(y2-y3) + x2*(y3-y1)+ x3*(y1-y2))/2.0);
};
//create new random rgb color str
function getNewColor (){
  return 'rgb('+getColorCode()+','+getColorCode()+','+getColorCode()+')';
};
//returns random number between  ans 255
function getColorCode (){
  return Math.floor(Math.random() * 255) + 0;
};
//canvas instannce constructor
function Canvas(canvas){
  this.canvas = canvas;
  this.height = canvas.height;
  this.width = canvas.width;
  this.triangleArr = [];
  this.isOnTriangle = false;
  this.imx;
  this.imy;
  this.fmx;
  this.fmy;
  var self = this;
  this.ctx = canvas.getContext('2d');
  //mousedown event listener
  canvas.addEventListener('mousedown', function(event){
    self.imx = event.clientX;
    self.imy = event.clientY;
    if(self.triangleArr.length){
      let i=0;
      self.triangleArr.forEach(function(triangle){
        if(triangle.checkPos(self.imx, self.imy)){
          self.isOnTriangle = true;
          self.selected = triangle;
          self.selectedPos = i;
        }
        i++;
      });
    } else {
      self.isOnTriangle = false;
    }
    event.preventDefault();
  });
  //mouseup event listener
  canvas.addEventListener('mouseup', function(event){
    self.fmx = event.clientX;
    self.fmy = event.clientY;
    if(self.isOnTriangle){
      let tri = self.triangleArr[self.selectedPos];
      self.triangleArr.splice(self.selectedPos, 1);
      let xdiff = self.fmx-self.imx;
      let ydiff = self.fmy-self.imy;
      tri.x1+=xdiff;
      tri.y1+=ydiff;
      tri.x2+=xdiff;
      tri.y2+=ydiff;
      tri.x3+=xdiff;
      tri.y3+=ydiff;
      self.triangleArr.push(tri);
      self.isOnTriangle=false;
      self.clear();
    } else {
      self.triangleArr.push(new Triangle(self.imx, self.imy, self.fmx, self.fmy, getNewColor()));
    }
    event.preventDefault();
  });
  //double-click event listener
  canvas.addEventListener('dblclick', function(event){
    self.triangleArr.splice(self.selectedPos, 1);
    self.clear();
    event.preventDefault();
  });
  setInterval(function() {
    self.draw();
  }, 10);
  document.getElementById("clear").addEventListener("click", cl);
  function cl(){
  self.triangleArr=[];
  self.clear();
  }
};
//function to draw triangle from array
Canvas.prototype.draw = function(){
  if(!this.isOnTriangle){
    let self = this;
    this.triangleArr.forEach(function(triangle){
      triangle.drawTriangles(self.ctx);
    });
  }
};
//function to clear canvas
Canvas.prototype.clear = function(){
  this.ctx.clearRect(0, 0, this.width, this.height);
};
(function(){
  var c = document.getElementById('canvas1');
  c.height = 500;
  c.width = 1340;
  var ca = new Canvas(c);
})();
</script>
</html>
